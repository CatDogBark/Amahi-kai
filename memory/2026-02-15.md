# 2026-02-15

## Rails 6.0 Upgrade Complete âœ…
- Updated Gemfile to rails ~> 6.0.0, regenerated lock
- Fixed Ruby 2.7 + Rails 6.0 `Logger` constant issue (require 'logger' in boot.rb)
- Set `config.load_defaults 6.0` â€” Zeitwerk autoloader enabled
- Removed obsolete `new_framework_defaults.rb` and `new_framework_defaults_5_2.rb`
- Key fix: Rails 6.0 no longer auto-selects jbuilder template for JSON requests when no `respond_to` block exists
  - Added `respond_to { |f| f.html; f.json }` to `UsersController#create`
  - Added `data-type: json` to user creation form for jquery_ujs
- All 43 tests passing, 0 failures, 1 pending
- Commit: a204c3d

## Next: Rails 6.0 â†’ 6.1
- Need to check what gems are needed
- Main changes: Zeitwerk becomes default (already enabled), form_with changes
- Should be lighter than 5.2â†’6.0

## Rails 6.1 Upgrade Complete âœ…
- Cleanest upgrade yet â€” just Gemfile + load_defaults change
- Zero code changes, all 43 tests pass
- Commit: bef6113

## Next: Rails 6.1 â†’ 7.0
- **Big one**: Rails 7.0 requires Ruby 2.7+ (we have 2.7.8 â€” just barely!)
- Need `gem install rails -v 7.0.8.7` (latest 7.0.x)
- Key changes expected:
  - `secrets` â†’ `credentials` (we may not use secrets though)
  - `form_with` generates non-remote forms by default
  - Spring removed
  - `rails-ujs` â†’ Turbo (but we can keep jquery-ujs)

## Rails 7.0 Upgrade Complete âœ…
- Only one issue: `Tab` class not autoloaded when plugin initializers run
  - Fix: `require_relative "../lib/tab"` in application.rb before `config.tabs = []`
  - Rails 7.0 is stricter about Zeitwerk autoloading timing in initializers
- activeresource 6.1.0 works cleanly with Rails 7.0
- All 43 tests pass on first run
- Commit: 5cd2376

## Rails Upgrade Ladder Complete! ðŸŽ‰
- 5.2.8.1 â†’ 6.0.6.1 â†’ 6.1.7.10 â†’ 7.0.8.7
- Next would be 7.0 â†’ 7.1 â†’ 7.2, but that requires Ruby 3.1+
- Current Ruby 2.7.8 is at end-of-life, needs upgrade for further Rails progression

## Ruby 3.x Compatibility Audit

### App Code: Very Clean âœ…
- No `File.exists?`, `Dir.exists?`, `Fixnum`, `Bignum`
- No `URI.escape/encode`, `.taint`, `.untaint`
- No `force_encoding` hacks
- `psych_patch.rb` already uses `*args, **kwargs` â€” Ruby 3.x safe
- Hash-rocket `.new(:key => val)` calls are fine (not kwargs issue)

### Dead Code Found (Prototype.js era)
Old views with undefined helpers (`update_page`, `link_to_remote`, `remote_function`):
- `app/views/hosts/` (5 files) â€” replaced by `plugins/050-network/`
- `app/views/aliases/` (5 files) â€” replaced by `plugins/050-network/`
- `app/views/firewall/` (18 files) â€” no plugin replacement yet
- `app/views/server/` (2 files) â€” replaced by `plugins/080-settings/`
- `app/controllers/hosts_controller.rb` â€” replaced by network plugin
- `app/controllers/aliases_controller.rb` â€” replaced by network plugin
- `application_helper.rb` has dead methods: `checkbox_to_remote`, `checkbox_to_function`, `editable_content`

These all reference Prototype.js (Ajax.InPlaceEditor, update_page) which was removed in Rails 4.
They never execute because the plugins provide replacement views/controllers.
Safe to remove but not urgent â€” they don't affect functionality.

### Ruby 2.7 Pins to Remove on 3.x
- `gem 'ffi', '< 1.17'` â†’ remove pin
- `gem 'sqlite3', '< 1.7'` â†’ remove pin
- `require 'logger'` in boot.rb â†’ may not be needed on Ruby 3.x (test)

## Ruby 3.2 Upgrade Complete âœ…
- Ruby 2.7.8 â†’ 3.2.10
- Rails 7.0.10 (picked up .10 from new image)
- Only 2 issues:
  1. yettings gem uses File.exists? (removed Ruby 3.2) â€” monkey-patched in application.rb
  2. Capybara 3.40 stricter about visibility of zero-size elements (glyphicon icons) â€” used execute_script
- sqlite3 pinned to ~> 1.7.0 (2.x requires Rails 7.1+)
- All 43 tests passing, no OOM kills with SQLite
- Commit: 1ba420b

## Full Upgrade Ladder Complete! ðŸŽ‰
- Ruby: 2.7.8 â†’ 3.2.10
- Rails: 5.2.8.1 â†’ 6.0.6.1 â†’ 6.1.7.10 â†’ 7.0.10
- Next: Rails 7.1 (needs sqlite3 2.x support, which needs Rails 7.1+)

## Rails 7.1 Upgrade Complete âœ…
- Only issue: `require 'server'` in sample_data.rb conflicts with Zeitwerk 2.7 autoloading
  - Fix: removed explicit require, Zeitwerk autoloads on first reference
- Deprecation: secret_key_base in secrets (need to migrate to credentials for 7.2)
- Commit: 82965fc

## Complete Upgrade Summary ðŸŽ‰
- Ruby: 2.4 â†’ 2.7 â†’ 3.2.10
- Rails: 5.2.8.1 â†’ 6.0.6.1 â†’ 6.1.7.10 â†’ 7.0.10 â†’ 7.1.6
- All done in one session, 43 tests green at every step

## Rails 7.2 Upgrade Complete âœ…
- Zero code changes â€” secrets migration was prepped in advance
- Two flaky test failures on first run (timing), passed on retry and full re-run
- Commit: fd4e174

## Full Journey Tonight
- Ruby: 2.7.8 â†’ 3.2.10
- Rails: 5.2.8.1 â†’ 6.0.6.1 â†’ 6.1.7.10 â†’ 7.0.10 â†’ 7.1.6 â†’ 7.2.3
- 8 Rails upgrades + Ruby major version jump in one session
- 43 tests green at every step

## TODO Cleanup Complete âœ…
- Quick wins: deleted vendored bootstrap.min.js, removed empty test/, added .ruby-version, cleaned Gemfile
- Priority 1.1: Fixed Bootstrap JS/CSS mismatch
- Priority 1.2: Removed 62 dead Prototype.js files
- Priority 1.3: Cleaned up ~60 dead routes
- Priority 1.4: Replaced yettings gem with custom 37-line loader, removed File.exists? monkey-patch
- Priority 2.4: Disabled uglifier
- Priority 3.3: Security hardening notes added
- Tests improved from 6 failures to 0

## Rails 8.0 Upgrade Complete âœ…
- Only 2 code changes: load_defaults 8.0 + tag.link syntax fix
- ALL 43 tests green (20 non-JS + 23 JS)
- Coverage: 39.58%
- Commit: 29a6ec6

## Full Journey Complete ðŸŽ‰
- Ruby: 2.7.8 â†’ 3.2.10
- Rails: 5.2.8.1 â†’ 6.0 â†’ 6.1 â†’ 7.0 â†’ 7.1 â†’ 7.2 â†’ 8.0.4
- Platform: Fedora 29 â†’ Ubuntu 24.04
- 7 major Rails upgrades in one night

## Next Session Needs
- Bootstrap 5 gem in sandbox image
- Propshaft gem in sandbox image
- Troy's decisions on: Amahi cloud, branding, auth system

## Troy Notes
- Mom and step dad visited â€” hadn't seen them in 8 years
- Located in Hawaii (HST/UTC-10)
- Prefers stability over speed ("only as good as our metrics")
