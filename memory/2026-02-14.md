# 2026-02-14 â€” Day One

- Woke up, met Troy (Hawaii, HST/UTC-10)
- Chose name: **Kai** ðŸŒŠ (ocean in Hawaiian)
- Project: **Amahi Platform** â€” Rails 5.2 home server management app (AGPL)
- Goal: Revive dead Fedora project for Ubuntu, make fork public

## Environment
- Ruby 2.7.8, Rails 5.2.8.1, MariaDB 10.5, Debian 11 sandbox
- `start-mariadb` â†’ socket at /tmp/mysqld.sock, no auth
- `BUNDLE_APP_CONFIG=/tmp/.bundle` for all bundle commands
- Git: Kai (AI Agent) <kai@amahi-kai.local>

## Commits (5 total)
1. **Phase 1: Stabilize** â€” Gemfile, binstubs, manifest.js, psych patch, db config, seeds, factories, spec_helper
2. **Authlogic 6.5 compat** â€” password_confirmation attr_accessor, controller fix, spec tags
3. **Deprecation fixes** â€” update_attributes â†’ update, File.exists? â†’ File.exist?
4. **Phase 2: Platform modernization** â€” Dockerfileâ†’Ubuntu, docker-composeâ†’MariaDB, systemd service commands, mariadb service names
5. **URI.escape fix** â€” search_controller

## Test Status
- Non-JS: **20 examples, 0 failures, 1 pending** âœ…
- JS: **15 examples**, need chromium+selenium (tagged `js: true`)
- Run: `BUNDLE_APP_CONFIG=/tmp/.bundle bundle exec rspec --tag ~js`

## Tools Needed for Next Image Build
- **chromium** (or chromium-browser) + **chromedriver** â€” for JS feature specs
- **selenium-webdriver** gem â€” add to Gemfile test group (I can do this)

## What's Done
- âœ… App boots and serves pages on Debian/Ubuntu
- âœ… All non-JS tests passing
- âœ… Gemfile cleaned, modern dependencies
- âœ… Dockerfile + docker-compose updated for Ubuntu 24.04 + MariaDB
- âœ… Platform class uses systemd everywhere
- âœ… All deprecations fixed (update_attributes, File.exists?, URI.escape)
- âœ… Authlogic 6.5 compatibility

## What's Next
- JS feature specs (need chromium)
- Authlogic crypto migration (Sha512 â†’ SCrypt) 
- Rails upgrade planning (5.2 â†’ 6.0)
- Coffee â†’ JS migration planning

## Late Session Update (post-compaction flush)

### Additional Commits (9 total now)
6. **Security + deprecation** â€” SCrypt crypto migration done, render :text â†’ render plain:, selenium-webdriver Gemfile prep
7. **README** â€” fully rewritten for Ubuntu fork with credits
8. **bin/dev-setup** â€” quick dev environment setup script
9. **Makefile** â€” modernized for Ubuntu workflow

### Key Details to Remember
- Troy's vision: revive Amahi (dead on Fedora 10+ years) for Ubuntu, make fork public, credit AI agent + original contributors
- Sandbox quirks: root filesystem read-only, /usr/local/bundle read-only, must use BUNDLE_APP_CONFIG=/tmp/.bundle
- `bundle lock --local` to generate Gemfile.lock (can't `bundle install` due to read-only gem path)
- Psych 5.3.1 gem installed on Ruby 2.7 â€” requires psych_patch.rb for YAML alias support
- Password hashing now SCrypt with Sha512 transition (auto-rehash on login)
- memory/ is gitignored (correct â€” personal agent files)
- IDENTITY.md, USER.md, SOUL.md etc are in workspace but also gitignored or not tracked
- Troy is patient, hands-on with infra, runs N100 NAS board with 16GB RAM
- It's Valentine's Day and Troy stayed up late helping me get set up ðŸ¥²

## Feature Spec Deep Dive (late session)

### Test Results: 28 examples, 8 failures, 1 pending (non-JS)
- Improved from 35 examples/25 failures through systematic fixes

### Remaining Failures
- **users_tab_spec.rb** (3 failures): password/pin change specs â€” likely need JS or form interaction fixes
- **user_create_spec.rb** (5 failures): validation specs use `click_button "New User"` + `wait_for_ajax` â€” these fundamentally need JS but aren't all tagged yet

### Fixes Applied This Session
- `user_sessions_controller.rb` line 94: was passing `password_confirmation` to `User.new` â†’ fixed to set password separately
- `User` model: added `attr_accessor :password_confirmation` (authlogic 6.x removed it but forms/controllers expect it)
- `front_page_spec.rb`: fixed ambiguous "Logout" link with `first(:link, "Logout").click`
- `URI.escape` â†’ `URI.encode_www_form_component` in search_controller
- Tagged JS-dependent specs: shares_tab_spec, network_spec, disks Fahrenheit test
- `db/seeds.rb` updated for authlogic 6.5 model changes

### Architecture Notes
- Test DB: SQLite (`db/test.sqlite3`); Dev DB: MariaDB (`hda_development`)
- Users plugin: `plugins/010-users/app/controllers/users_controller.rb` â€” has `password_confirmation` in strong params
- `dummy_mode: true` in dev yettings skips system calls
- Platform detects as `debian` via `/etc/issue`
- Admin login: `admin` / `secretpassword` (from seeds)

### Next Steps (priority order)
1. Determine if user_create_spec failures need JS tags or rack_test fixes
2. Fix users_tab_spec password/pin change failures  
3. Get chromium+chromedriver in sandbox for JS specs
4. Wire up minitest functional tests (test/functional/ â†’ test/controllers/)
5. Commit feature spec fixes
6. Phase 2 continued: code quality, more deprecation cleanup
7. Phase 3: Rails upgrade path (5.2 â†’ 6.0 â†’ 6.1 â†’ 7.0)
