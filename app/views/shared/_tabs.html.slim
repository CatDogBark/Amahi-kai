ruby:
  tabs = [
    { id: 'users', label: 'users', url: '/users' },
    { id: 'shares', label: 'shares', url: '/shares', subtabs: [
      { id: 'index', label: 'details', url: '/shares' },
      { id: 'settings', label: 'settings', url: '/shares/settings', advanced: true }
    ]},
    { id: 'network', label: 'network', url: '/network', advanced: true, subtabs: [
      { id: 'index', label: 'leases', url: '/network' },
      { id: 'hosts', label: 'hosts', url: '/network/hosts' },
      { id: 'gateway', label: 'gateway', url: '/network/gateway', advanced: true },
      { id: 'dns_aliases', label: 'dns_aliases', url: '/network/dns_aliases', advanced: true },
      { id: 'settings', label: 'settings', url: '/network/settings', advanced: true },
      { id: 'remote_access', label: 'remote_access', url: '/network/remote_access' },
      { id: 'security', label: 'security', url: '/network/security' }
    ]},
    { id: 'disks', label: 'disks', url: '/disks', subtabs: [
      { id: 'index', label: 'disks', url: '/disks' },
      { id: 'devices', label: 'devices', url: '/disks/devices' },
      { id: 'mounts', label: 'mounts', url: '/disks/mounts' },
      { id: 'storage_pool', label: 'storage_pool', url: '/disks/storage_pool' }
    ]},
    { id: 'apps', label: 'apps', url: '/apps', subtabs: [
      { id: 'docker_apps', label: 'available', url: '/apps' },
      { id: 'installed_apps', label: 'installed', url: '/apps/installed_apps' }
    ]},
    { id: 'settings', label: 'settings', url: '/settings', subtabs: [
      { id: 'index', label: 'details', url: '/settings' },
      { id: 'system_status', label: 'system status', url: '/settings/system_status', advanced: true },
      { id: 'servers', label: 'servers', url: '/settings/servers', advanced: true },
      { id: 'themes', label: 'themes', url: '/settings/themes', advanced: true }
    ]}
  ]
  visible_tabs = @advanced ? tabs : tabs.reject { |t| t[:advanced] }
  ctrl = params[:controller].to_s
  act = params[:action].to_s
  active_tab = visible_tabs.find { |t| t[:id] == ctrl } || visible_tabs.find { |t| t[:subtabs]&.any? { |s| s[:id] == act } }

ul.nav.nav-tabs.setup-main-tab
  - visible_tabs.each do |tab|
    - is_active = (tab == active_tab)
    li.nav-item
      a.nav-link.text-capitalize.tab-link-style href=tab[:url] class=("active active-tab-link-style" if is_active)
        = t(tab[:label])

- if active_tab && active_tab[:subtabs]&.any?
  - visible_subtabs = @advanced ? active_tab[:subtabs] : active_tab[:subtabs].reject { |s| s[:advanced] }
  - if visible_subtabs.any?
    .setup-subtab-container
      ul.nav.nav-tabs.setup-subtab
        - visible_subtabs.each do |subtab|
          - sub_active = (subtab[:id] == act) || (subtab[:id] == 'index' && act == active_tab[:id]) || (subtab[:url] == request.path)
          li.nav-item
            - if sub_active
              a.text-capitalize.active-subtab-link href=subtab[:url]
                = t(subtab[:label])
            - else
              a.text-capitalize.subtab-link href=subtab[:url]
                = t(subtab[:label])
