<% content_for :progress do %>
  <div class="step done"></div>
  <div class="step done"></div>
  <div class="step done"></div>
  <div class="step current"></div>
  <div class="step"></div>
  <div class="step"></div>
  <div class="step"></div>
<% end %>

<h2>ğŸ’¾ Storage Drives</h2>
<p>
  Amahi-kai can detect your drives and prepare them for use.
  Select drives to add to your storage pool. <strong>OS drives cannot be selected.</strong>
</p>

<% if @devices.any? { |d| !d[:os_disk] } %>
  <%= form_tag(setup_update_storage_path, method: :post) do %>
    <div class="drive-list">
      <% @devices.each do |device| %>
        <% next if device[:os_disk] %>
        <% device[:partitions].each do |part| %>
          <div class="drive-item" style="flex-wrap: wrap;">
            <input type="checkbox" name="drives[]" value="<%= part[:path] %>"
                   id="drive_<%= part[:path].gsub('/', '_') %>"
                   data-status="<%= part[:status] %>"
                   <%= 'checked' if @pool_paths.include?(part[:path]) || @pool_paths.include?(part[:mountpoint]) %>>
            <label for="drive_<%= part[:path].gsub('/', '_') %>" style="display: inline; margin: 0; cursor: pointer; flex: 1;">
              <span class="drive-path"><%= device[:model] %></span>
              <span style="color: #7f8c9b; font-size: 13px; margin-left: 6px;">
                (<%= part[:path] %>)
              </span>
            </label>
            <span class="drive-size"><%= part[:size] %></span>
            <div style="width: 100%; margin-left: 30px; margin-top: 4px; font-size: 12px;">
              <% case part[:status] %>
              <% when :mounted %>
                <span style="color: #10b981;">âœ“ Mounted at <%= part[:mountpoint] %></span>
                <span style="color: #7f8c9b; margin-left: 8px;"><%= part[:fstype] %></span>
              <% when :unmounted %>
                <span style="color: #f59e0b;">âš  Formatted (<%= part[:fstype] %>) but not mounted â€” will be mounted automatically</span>
              <% when :unformatted %>
                <span style="color: #ef4444;">âŠ˜ Unformatted â€” will be formatted (ext4) and mounted automatically</span>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <p style="font-size: 12px; color: #9ca3af; margin-top: 4px;">
      âš ï¸ Formatting a drive erases all data on it. Only unformatted drives will be formatted.
    </p>

    <div class="setup-actions">
      <a href="<%= setup_greyhole_path %>" class="btn-skip">Skip</a>
      <button type="submit" class="btn-kai">Prepare Drives & Continue â†’</button>
    </div>
  <% end %>
<% else %>
  <div style="text-align: center; padding: 20px; color: #7f8c9b;">
    <p>No additional drives detected beyond your OS disk.</p>
    <p style="font-size: 13px;">You can add drives later from the Shares settings.</p>
  </div>
  <div class="setup-actions">
    <div></div>
    <a href="<%= setup_greyhole_path %>" class="btn-kai">Continue â†’</a>
  </div>
<% end %>
